---
date: "2022-11-14"
title: "tWIL 2022.11 2주차"
draft: true
summary: "This week I learned"
featured: /static/images/eunchurn/zoom.PNG
categories:
  - blog
tags:
  - development
  - vscode
  - supertokens
  - prisma
  - apollo server
  - graphql
  - react
---

주말에 코감기로 인해 컨디션이 떨어져서 월요일에 tWIL를 쓰게 되었다. 일주일 정도 보충제 휴약을 했더니 면역체계가 무너진 듯 하다.

지지난주에 배포했던 SuperTokens 컨테이너는 같은 AWS ECS 클러스터안에 서비스를 분리하였다. SuperTokens이 동작하는 원리는

![supertokens self hosted](/static/images/2022/11/self_hosted_generic.png)

## VSCODE 점유율 문제

지난 주였을 것 같다. visual studio code가 업데이트 된 이후 한 VSCODE 프로젝트 창마다 CPU 점유율이 200%를 치고 있었다(feat. `htop`). 몇개의 의심되는 Extension을 disabled 해도 해결이 안되었고, `Developer: Show Running Extensions`로 로깅해봐도 문제가 해결되지 않았다. 심지어 Visual Studio Code Insiders까지 설치해보고 했지만 여전히 증상은 그대로 TypeScript 인텔리센스 기능도 동작하지 않았다. PC 재부팅을 여러번 해도 나아지지 않아서 오기를 가지고 `htop`을 켜고 익스텐션을 하나씩 제거하기 시작했다.

원인: `Setting Sync`

VSCODE 자체적으로 Setting Sync가 동작하기 때문인지 알 수 없지만, 이 녀석이 200% 점유율을 만들어내고 있었다. 대략 5시간 삽질 끝에 알아냈으며 유용하게 잘 쓰던 이 익스텐션은 이제 역사 속으로...

## 인프라 수정

기존 Auth 컨테이너를 별개의 ECS Cluster로 구축했었다. 하지만 Auth 컨테이너는 Private subnet에 위치하고 internal load balancer를 붙여야 맞을 것 같다. 그래서 ALB는 API 컨테이너 서비스에 연결하고, Auth 컨테이너를 Private 컨테이너로 재구축을 하였다. 이 블로그 [Provisioning Multiple ECS Services Using Terraform](https://towardsaws.com/provisioning-multiple-ecs-services-using-terraform-d4448354c803)를 참고하여 인프라 수정을 진행하였다.

## SuperTokens의 수정

지난번 Prisma `db pull`을 통해 같은 DB에 SuperTokens의 DB를 위치했는데 아무래도 여기 테이블은 건들지 않는 편이 좋겠다고 판단하여 별개로 분리했다. 그리고 `override` 옵션을 통해 `originalImplementation`에 post hook을 걸어 데이터 동기화를 시켜주기로 한다.

그리고 Recipe는 추후 소셜로그인을 허용하기 위해 `ThirdParyEmailPassword` 레시피를 사용하였다.

## Client 수정

## Default UI 제거

## Terraform forcing replacement 이슈

매번 배포할 때 마다 Auth 서비스를 강제로 Replacement 하는 이슈가 있다.

[이슈 링크](https://github.com/hashicorp/terraform-provider-aws/issues/11526)

## Apollo Server v4

### Apollo Explorer
